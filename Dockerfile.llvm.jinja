#
# This builds the base image for building Mesa.
#
# ~~~
#  dj -d Dockerfile.llvm.jinja -o Dockerfile.llvm    \
#    -e LLVM=3.3            # 3.3, 3.6, 3.8 or 3.9   \
#    [-e BUILDJOBS=2]       # -j 2,3,... for make
#  docker build [--pull] -f Dockerfile.base -t igalia/mesa:base .
#

FROM igalia/mesa:base

LABEL maintainer "Juan A. Suarez Romero <jasuarez@igalia.com>"

{% if LLVM == "3.9" %}
RUN apt-get update                                                            \
  && apt-get --no-install-recommends -y install libclang-3.9-dev llvm-3.9-dev \
  && rm -fr /var/lib/apt/lists/*
{% elif LLVM == "3.8" %}
RUN apt-get update                                                            \
  && apt-get --no-install-recommends -y install libclang-3.8-dev llvm-3.8-dev \
  && rm -fr /var/lib/apt/lists/*
{% endif %}

USER local

WORKDIR /home/local

{% if LLVM == "3.3" %}
RUN wget http://releases.llvm.org/3.3/clang+llvm-3.3-amd64-debian6.tar.bz2 \
  && tar xjpf clang+llvm-3.3-amd64-debian6.tar.bz2                         \
  && rm clang+llvm-3.3-amd64-debian6.tar.bz2                               \
  && sudo mv clang+llvm-3.3-amd64-debian6 /usr/local/lib/llvm-3.3
{% elif LLVM == "3.6" %}
RUN wget http://releases.llvm.org/3.6.2/clang+llvm-3.6.2-x86_64-linux-gnu-ubuntu-15.04.tar.xz \
  && tar xJpf clang+llvm-3.6.2-x86_64-linux-gnu-ubuntu-15.04.tar.xz                           \
  && rm clang+llvm-3.6.2-x86_64-linux-gnu-ubuntu-15.04.tar.xz                                 \
  && sudo mv clang+llvm-3.6.2-x86_64-linux-gnu-ubuntu-15.04 /usr/local/lib/llvm-3.6
{% endif %}

USER root
