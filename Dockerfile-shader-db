#
# This builds and installs Mesa, master.
#
#   `docker build . -f Dockerfile-shader-db -t igalia/mesa:shader-db`
#
# To run
#
#   `docker run --rm -v ~/my_results_dir/shader-db-$(date -u +%Y%m%d+%H%M):/results:Z --device=/dev/dri/renderD128 igalia/mesa:shader-db`
#

FROM igalia/mesa:master

LABEL maintainer "Juan A. Suarez Romero <jasuarez@igalia.com>"

RUN apt-get update                              \
  && apt-get -y install python3 libepoxy-dev    \
  && rm -fr rm -rf /var/lib/apt/lists/*

RUN git clone git://anongit.freedesktop.org/mesa/shader-db /root/shader-db

WORKDIR /root/shader-db

RUN git show --stat > /root/piglit-head.txt

RUN make

CMD [ "/bin/sh", "-c", "cp /root/*head.txt /results && ./run shaders > /results/results.txt" ]
